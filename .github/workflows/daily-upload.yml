name: Daily Log Upload

on:
  schedule:
    - cron: '45 23 * * *' # 4:45 PM Idaho = 23:45 UTC
  workflow_dispatch: # optional manual trigger

jobs:
  upload:
    runs-on: ubuntu-latest
    steps:
      # Step 1: Get your repo files
      - uses: actions/checkout@v3

      # Step 2: Set up Python
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      # Step 3: Install Python dependencies
      - name: Install dependencies
        run: pip install requests

      # Step 4: Run the Python download script
      - name: Download log file
        run: python main.py

      # Step 5: Install gdrive CLI
      - name: Install gdrive
        run: |
          wget -O gdrive.tar.gz https://github.com/prasmussen/gdrive/releases/download/2.1.1/gdrive_2.1.1_linux_amd64.tar.gz
          tar -xzf gdrive.tar.gz
          chmod +x gdrive

      # Step 6: Upload the log file to your Google Drive folder
      - name: Upload to Google Drive
        run: ./gdrive upload --parent 1zUTic9O4yp1ZGWwwv75z60yApb___QoO latest_*.log
        env:
          GDRIVE_TOKEN_PATH: token_v2.json
